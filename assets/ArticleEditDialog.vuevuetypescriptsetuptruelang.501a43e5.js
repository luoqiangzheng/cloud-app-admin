var K=Object.defineProperty;var X=(e,c,o)=>c in e?K(e,c,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[c]=o;var S=(e,c,o)=>(X(e,typeof c!="symbol"?c+"":c,o),o);import{I as G,J as Y,x as Z,B as ee,w as te,F as ae,K as oe}from"./element-plus.b7bae97a.js";import{m as W,r as p,w as M,f as E,k as le,R as ne,o as k,c as U,X as N,Q as F,F as L,a7 as re,M as z,u as C,P as q,J as se,T as $,am as T,U as I,a0 as H,a3 as ce,d as ie,a as ue,V as J,W as Q}from"./@vue.868258c7.js";import{c as b,j as B,u as de}from"./index.bf48c991.js";import{u as j}from"./vue-i18n.8110a5da.js";const me=W({__name:"CForm",props:{options:{type:Array,require:!0},gutter:{type:Number,default:24},colSpan:{type:Object,require:!1},value:{type:Object,require:!0,default:()=>{}},loading:{type:Boolean,default:!1}},emits:["submit","update:value"],setup(e,{expose:c,emit:o}){const r=e,g={input:"el-input",select:"el-select",inputNumber:"el-input-number",timePicker:"el-time-picker",datePicker:"el-date-picker"},V=["el-input","el-input-number","async-select"],i=p(),f=p({}),v=p([]),h=p({});M(()=>r.options,l=>{const a={};v.value=l.map(d=>{let{name:y,type:w,rules:D,tagName:t,...n}=d;return D&&(a[y]=D),g[w]&&!t&&(t=g[w]),{...n,name:y,tagName:t}}),f.value=a},{immediate:!0});const u=E(()=>{const l=r.options&&r.options.length>10?{md:12,xs:24}:{span:24};return r.colSpan||l});async function x(){var l;await((l=i.value)==null?void 0:l.validate(a=>{if(a){const d=r.value;o("submit",d)}}))}function A(...l){var a;(a=i.value)==null||a.validateField(...l)}function O(...l){var a;(a=i.value)==null||a.validate(...l)}function R(...l){var a;(a=i.value)==null||a.resetFields(...l)}function P(...l){var a;(a=i.value)==null||a.clearValidate(...l)}return c({validateField:A,validate:O,resetFields:R,clearValidate:P,submit:x}),M(()=>r.value,l=>{h.value=l},{immediate:!0}),le(()=>{o("update:value",h.value)}),(l,a)=>{const d=G,y=te,w=Z,D=ee;return ne((k(),U("div",null,[N(C(Y),z({ref_key:"formRef",ref:i,rules:f.value,model:e.value},l.$attrs),{default:F(()=>[N(w,{gutter:e.gutter},{default:F(()=>[(k(!0),U(L,null,re(v.value,(t,n)=>(k(),U(L,{key:n},[t.hidden?I("",!0):(k(),q(y,z({key:0},t.colSpan||C(u),{key:t.name}),{default:F(()=>[N(d,z({prop:t.name,label:t.label},t.itemExtra),{default:F(()=>{var s,_;return[t.scopedSlot&&l.$slots[t.scopedSlot]?se(l.$slots,t.scopedSlot,{key:0,value:e.value,option:t}):t.tagName?(k(),U(L,{key:1},[V.includes(t.tagName)?(k(),q($(t.tagName),z({key:0,modelValue:h.value[t.name],"onUpdate:modelValue":m=>h.value[t.name]=m,modelModifiers:{trim:!0}},t.props,T((s=t.on)!=null?s:{})),null,16,["modelValue","onUpdate:modelValue"])):(k(),q($(t.tagName),z({key:1,modelValue:h.value[t.name],"onUpdate:modelValue":m=>h.value[t.name]=m},t.props,T((_=t.on)!=null?_:{})),null,16,["modelValue","onUpdate:modelValue"]))],64)):I("",!0)]}),_:2},1040,["prop","label"])]),_:2},1040))],64))),128))]),_:3},8,["gutter"])]),_:3},16,["rules","model"])])),[[D,e.loading]])}}});class pe{constructor(c){S(this,"dataSource",p([]));S(this,"loading",p(!1));S(this,"queryParam",p());S(this,"url",p({}));S(this,"modalFormRef",p());S(this,"drawerFormRef",p());S(this,"ipagination",H({current:1,total:0,pageSize:10,pageSizeOptions:[5,10,20,50,100]}));this.url.value=c}}function ge(e){const c=new pe(e),{t:o}=j(),{dataSource:r,ipagination:g,loading:V,queryParam:i,modalFormRef:f,drawerFormRef:v}=ce(H(c)),h=()=>({page:g.value.current,pageSize:g.value.pageSize,...i.value}),u=async(n=!1)=>{if(!e.list){b("error",o("page.common.notice.set_url_list"));return}n&&(g.value.current=1);const s=h();try{V.value=!0;const _=await B.get(e.list,s);r.value=_.data,g.value.total=_.total}finally{V.value=!1}},x=()=>{f.value.edit({}),f.value.title=o("page.common.title.add")},A=n=>{i.value=n,u(!0)},O=()=>{i.value={},u(!0)},R=(n,s=o("page.common.title.edit"))=>{f.value.edit(n),f.value.title=s},P=async n=>new Promise(async(s,_)=>{try{if(!e.add){b("error",o("page.common.notice.set_url_add"));return}const m=await B.post(e.add,{params:n});m.code===200&&m.data.count>0&&s(m)}catch(m){_(m)}}),l=async n=>new Promise(async(s,_)=>{try{if(!e.edit){b("error",o("page.common.notice.set_url_edit"));return}const m=await B.post(e.edit,{params:n});m.code===200&&m.data.count>0&&s(m)}catch(m){_(m)}}),a=async n=>{if(!e.delete){b("error",o("page.common.notice.set_url_delete"));return}const s=await B.post(e.delete,{params:{id:n}});s.code===200&&s.data.count>0&&(b("success",o("page.common.notice.delete_success")),u(!0))},d=async n=>{if(!e.batchDelete){b("error",o("page.common.notice.set_url_batchDelete"));return}const s=await B.post(e.batchDelete,{params:{ids:n}});s.code===200&&s.data.count>0&&(b("success",o("page.common.notice.batchDelete_success")),u(!0))},y=()=>{v.value.add(),v.value.title=o("page.common.title.add")},w=(n,s=o("page.common.title.edit"))=>{v.value.edit(n),v.value.title=s},D=n=>{g.value.pageSize=n,u()},t=n=>{g.value.current=n,u()};return ie(async()=>{await u(!0)}),{loadData:u,handleOpenAddDialog:x,handleOpenEditDialog:R,handleReset:O,handleAdd:P,handleEdit:l,handleDelete:a,handleBatchDelete:d,handleSearch:A,handleOpenAddDialogDrawer:y,handleOpenEditDialogDrawer:w,handleSizeChange:D,handleCurrentChange:t,dataSource:r,ipagination:g,modalFormRef:f,loading:V}}const fe={list:"/article",delete:"/deleteArticle",batchDelete:"/batchDeleteArticle",edit:"/editArticle",add:"/addArticle"},De=()=>{const{t:e}=j(),c=E(()=>[{label:e("page.common.design.article.search.title"),name:"title",tagName:"el-input",props:{placeholder:e("page.common.design.article.search.title_placeholder"),maxLength:"24"}},{label:e("page.common.design.article.search.content"),name:"content",tagName:"el-input",props:{placeholder:e("page.common.design.article.search.content_placeholder"),maxLength:"24"}},{label:e("page.common.design.article.search.type"),name:"type",tagName:"async-select",props:{placeholder:e("page.common.design.article.search.type_placeholder"),url:"/article/type",size:"default",style:{width:"100%"}}}]),o=E(()=>[{prop:"id",label:e("page.common.design.article.column.id"),width:"80"},{prop:"title",label:e("page.common.design.article.column.title"),width:"180"},{prop:"content",label:e("page.common.design.article.column.content"),showOverflowTooltip:!0},{prop:"actions",label:e("page.common.design.article.column.action"),fixed:"right",scoped:"actions",width:"150"}]);return{articleFilterOptions:c,articleColumns:o}},ve={class:"dialog-footer"},Se=W({__name:"ArticleEditDialog",emits:["close"],setup(e,{expose:c,emit:o}){const{t:r}=j(),{handleEdit:g,handleAdd:V}=ge(fe),i=p(!1),f=p(),v=p(""),{gtMd:h}=de(),u=p({}),x=E(()=>u.value.id!==void 0),A=E(()=>h.value?"50%":"80%");function O(a){u.value=Object.assign({},a),i.value=!0}function R(){var a;(a=f.value)==null||a.clearValidate(),i.value=!1}async function P(a){!a||await a.validate(d=>{d&&(x.value?g(u.value).then(()=>{b("success",r("page.common.notice.edit_success")),o("close"),i.value=!1}):V(u.value).then(()=>{b("success",r("page.common.notice.add_success")),o("close"),i.value=!1}))})}const l=E(()=>[{name:"title",type:"input",label:r("page.common.design.article.form.title"),rules:[{required:!0,message:r("page.common.design.article.form.title_placeholder"),trigger:"blur"}],props:{maxLength:50,placeholder:r("page.common.design.article.form.title_placeholder")}},{name:"content",type:"input",label:r("page.common.design.article.form.content"),rules:[{required:!0,message:r("page.common.design.article.form.content_placeholder"),trigger:"blur"}],props:{autosize:{minRows:4,maxRows:8},type:"textarea",placeholder:r("page.common.design.article.form.content_placeholder")}}]);return c({edit:O,title:v}),(a,d)=>{const y=ae,w=me,D=oe;return k(),q(D,{modelValue:i.value,"onUpdate:modelValue":d[2]||(d[2]=t=>i.value=t),width:C(A),title:v.value,onClose:R},{footer:F(()=>[ue("span",ve,[N(y,{onClick:R},{default:F(()=>[J(Q(C(r)("page.common.btn.cancel")),1)]),_:1}),N(y,{type:"primary",onClick:d[0]||(d[0]=t=>P(f.value))},{default:F(()=>[J(Q(C(r)("page.common.btn.confirm")),1)]),_:1})])]),default:F(()=>[N(w,{ref_key:"ruleFormRef",ref:f,value:u.value,"onUpdate:value":d[1]||(d[1]=t=>u.value=t),"label-width":"80px",options:C(l)},null,8,["value","options"])]),_:1},8,["modelValue","width","title"])}}});export{me as _,Se as a,fe as b,De as s,ge as u};
